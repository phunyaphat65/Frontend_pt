<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
    * { box-sizing: border-box; }

    body {
      font-family: "Prompt", sans-serif;
      background: #f6f8fb;
      margin: 0;
      color: #333;
    }

    nav {
      background: linear-gradient(90deg, #5264f9, #6a7dfc);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    nav a, nav button {
      color: #fff;
      text-decoration: none;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 15px;
      margin: 0 8px;
      transition: 0.2s;
    }

    nav a:hover, nav button:hover { text-decoration: underline; }

    .profile-container {
      max-width: 950px;
      margin: 50px auto;
      background: #fff;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 { color: #5264f9; margin-bottom: 25px; }

    .profile-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 25px;
    }

    .role-tag {
      background: #eaf0ff;
      color: #5264f9;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 13px;
    }

    .profile-box {
      display: flex;
      flex-wrap: wrap;
      gap: 40px;
      align-items: center;
    }

    .photo {
      flex: 1;
      text-align: center;
    }

    .photo img {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: 3px solid #d8defc;
      object-fit: cover;
      transition: 0.3s;
    }

    .photo img:hover { transform: scale(1.05); }

    .photo input { display: none; }
    .photo p { font-size: 14px; color: #777; margin-top: 8px; }

    .info {
      flex: 2;
      font-size: 15px;
    }

    table { width: 100%; border-collapse: collapse; }
    td { padding: 6px 5px; vertical-align: top; }
    td:first-child { width: 150px; color: #777; font-weight: 500; }

    .edit-btn {
      text-align: right;
      color: #5264f9;
      cursor: pointer;
      font-style: italic;
      margin-bottom: 10px;
      transition: 0.2s;
    }
    .edit-btn:hover { text-decoration: underline; }

    /* popup */
    .popup {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .popup.active { display: flex; }

    .popup-content {
      background: #fff;
      padding: 30px;
      border-radius: 14px;
      width: 420px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.25);
      animation: fadeIn 0.3s ease;
    }

    .popup-content h3 { margin-top: 0; color: #5264f9; }

    .popup-content input, .popup-content textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-family: inherit;
    }

    .popup-content .btn {
      margin-top: 15px;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #fff;
      font-size: 14px;
    }

    .save { background: #27ae60; }
    .cancel { background: #e74c3c; margin-left: 10px; }

    footer {
      text-align: center;
      color: #777;
      margin-top: 40px;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <nav>
    <div>
      <a href="index.html">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
      <a href="jobs.html">üíº ‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html">üìã ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="reviews.html">‚≠ê ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>
    <button onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </nav>

  <div class="profile-container">
    <div class="profile-header">
      <h2>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
      <div id="roleTag" class="role-tag"></div>
    </div>

    <div class="profile-box">
      <div class="photo">
        <label for="uploadPhoto">
          <img id="profileImage" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="avatar">
        </label>
        <input type="file" id="uploadPhoto" accept="image/*">
        <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
      </div>

      <div class="info">
        <div class="edit-btn" id="editProfile">(‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</div>
        <table>
          <tr><td>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• :</td><td id="name">-</td></tr>
          <tr><td>‡∏≠‡∏µ‡πÄ‡∏°‡∏• :</td><td id="email">-</td></tr>
          <tr><td>‡∏ó‡∏±‡∏Å‡∏©‡∏∞ :</td><td id="skills">-</td></tr>
          <tr><td>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà :</td><td id="address">-</td></tr>
          <tr><td>‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå :</td><td id="experience">-</td></tr>
          <tr><td>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ :</td><td id="phone">-</td></tr>
        </table>
      </div>
    </div>
  </div>

  <!-- popup -->
  <div class="popup" id="editPopup">
    <div class="popup-content">
      <h3>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
      <form id="editForm">
        <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input name="name" required>
        <label>‡∏ó‡∏±‡∏Å‡∏©‡∏∞</label>
        <input name="skills">
        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
        <textarea name="address"></textarea>
        <label>‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</label>
        <input name="experience">
        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
        <input name="phone">
        <div>
          <button type="submit" class="btn save">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button type="button" class="btn cancel" id="cancelEdit">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <footer>
    ¬© 2025 Part-time Match | All Rights Reserved
  </footer>

  <script>
    const SESSION_KEY = "pt_session";
    const USERS_KEY = "pt_users";
    const PROFILES_KEY = "pt_profiles";

    function getCurrentUser() {
      const email = localStorage.getItem(SESSION_KEY);
      if (!email) return null;
      const users = JSON.parse(localStorage.getItem(USERS_KEY) || "[]");
      return users.find(u => u.email === email) || null;
    }

    function getProfile(email) {
      const profiles = JSON.parse(localStorage.getItem(PROFILES_KEY) || "{}");
      return profiles[email] || {};
    }

    function saveProfile(email, data) {
      const profiles = JSON.parse(localStorage.getItem(PROFILES_KEY) || "{}");
      profiles[email] = data;
      localStorage.setItem(PROFILES_KEY, JSON.stringify(profiles));
    }

    function logout() {
      localStorage.removeItem(SESSION_KEY);
      alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      location.href = "auth.html";
    }

    // =========================
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
    // =========================
    const user = getCurrentUser();
    if (!user) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
      location.href = "auth.html";
    }

    const profile = getProfile(user.email);
    document.getElementById("roleTag").textContent =
      user.role === "shop" ? "‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤" : "‡∏ú‡∏π‡πâ‡∏´‡∏≤‡∏á‡∏≤‡∏ô";

    function renderProfile() {
      document.getElementById('name').textContent = profile.name || "-";
      document.getElementById('email').textContent = user.email;
      document.getElementById('skills').textContent = profile.skills || "-";
      document.getElementById('address').textContent = profile.address || "-";
      document.getElementById('experience').textContent = profile.experience || "-";
      document.getElementById('phone').textContent = profile.phone || "-";
      if (profile.image) document.getElementById('profileImage').src = profile.image;
    }
    renderProfile();

    // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
    document.getElementById('uploadPhoto').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        profile.image = reader.result;
        saveProfile(user.email, profile);
        document.getElementById('profileImage').src = reader.result;
      };
      reader.readAsDataURL(file);
    });

    // popup edit
    const popup = document.getElementById('editPopup');
    document.getElementById('editProfile').addEventListener('click', () => {
      popup.classList.add('active');
      const form = document.getElementById('editForm');
      form.name.value = profile.name || '';
      form.skills.value = profile.skills || '';
      form.address.value = profile.address || '';
      form.experience.value = profile.experience || '';
      form.phone.value = profile.phone || '';
    });

    document.getElementById('cancelEdit').addEventListener('click', () => {
      popup.classList.remove('active');
    });

    // ‡∏õ‡∏¥‡∏î popup ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å
    popup.addEventListener('click', e => {
      if (e.target === popup) popup.classList.remove('active');
    });

    document.getElementById('editForm').addEventListener('submit', e => {
      e.preventDefault();
      const form = e.target;
      profile.name = form.name.value.trim();
      profile.skills = form.skills.value.trim();
      profile.address = form.address.value.trim();
      profile.experience = form.experience.value.trim();
      profile.phone = form.phone.value.trim();
      saveProfile(user.email, profile);
      popup.classList.remove('active');
      renderProfile();
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ");
    });
  </script>
</body>
</html>
