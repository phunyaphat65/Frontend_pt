<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>üîç AI Matching | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin:0;
      padding:0;
      background:#eef1f9;
      font-family:"Prompt", sans-serif;
      display:flex;
      height:100vh;
      overflow:hidden;
    }

    /* ---------------- Sidebar ---------------- */
    .sidebar {
      width:240px;
      background:#ffffff;
      border-right:1px solid #dfe3ef;
      padding:20px 0;
      display:flex;
      flex-direction:column;
    }

    .logo {
      font-size:20px;
      font-weight:600;
      text-align:center;
      color:#444;
      margin-bottom:24px;
    }

    .menu {
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:0 16px;
    }

    .menu a {
      padding:10px 14px;
      text-decoration:none;
      color:#555;
      font-size:15px;
      border-radius:8px;
      transition:0.2s;
    }

    .menu a.active {
      background:#eef2ff;
      color:#4c55d9;
      font-weight:600;
    }

    .menu a:hover {
      background:#f4f5ff;
    }

    .logout-area {
      margin-top:auto;
      padding:20px;
    }

    .btn-logout {
      width:100%;
      border:none;
      padding:10px;
      background:#d9534f;
      color:#fff;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
    }

    /* -------------- Main Content -------------- */
    .main {
      flex:1;
      overflow-y:auto;
      padding:30px 40px;
    }

    .page-title {
      font-size:26px;
      color:#222;
      margin:0;
      font-weight:600;
    }

    .job-list {
      margin-top:28px;
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
      gap:18px;
    }

    .job-card {
      background:#fff;
      padding:18px;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
      transition:0.2s;
    }

    .job-card:hover {
      transform:translateY(-3px);
      box-shadow:0 6px 18px rgba(0,0,0,0.12);
    }

    .job-img {
      width:100%;
      height:160px;
      object-fit:cover;
      border-radius:10px;
      margin-bottom:10px;
      background:#eee;
    }

    .btn-apply, .btn-detail {
      width:100%;
      padding:10px;
      margin-top:8px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
    }

    .btn-detail {
      background:#6c63ff;
      color:#fff;
    }

    .btn-apply {
      background:#4caf50;
      color:#fff;
    }

    .btn-apply[disabled] {
      background:#aaa !important;
      cursor:not-allowed;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">Part-time Match</div>

    <div class="menu">
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="jobs.html">‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="matching.html" class="active">AI Matching</a>
      <a href="reviews.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>

    <div class="logout-area">
      <button id="logoutBtn" class="btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <h2 class="page-title">AI Matching</h2>
    <p>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ‚Üí ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î)</p>

    <div id="matchList" class="job-list"></div>

    <p id="noMatch" style="text-align:center;color:#888;margin-top:20px;display:none;">
      ‚ùó ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì
    </p>
  </div>

<script>

/* -----------------------------
   Login Check
----------------------------- */
const seekerEmail = localStorage.getItem("pt_seeker_session");
if (!seekerEmail) {
  Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô").then(() => location.href="../auth.html");
}

/* -----------------------------
   Data Keys
----------------------------- */
const JOBS_KEY = "pt_jobs";
const APPS_KEY = "pt_applications";

const loadJobs = () => JSON.parse(localStorage.getItem(JOBS_KEY) || "[]");
const loadApps = () => JSON.parse(localStorage.getItem(APPS_KEY) || "[]");

/* -----------------------------
   Matching Score Logic
----------------------------- */
function matchScore(job) {
  let score = 0;

  const wage = Number(job.wage || 0);
  const title = (job.title || "").toLowerCase();
  const rating = Number(job.rating || 0);

  if (wage >= 40) score += 10;
  if (wage >= 50) score += 20;
  if (wage >= 70) score += 20;

  if (title.includes("‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå")) score += 20;
  if (title.includes("‡∏î‡πà‡∏ß‡∏ô")) score += 10;
  if (title.includes("‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£")) score += 10;

  score += rating * 5;

  return score;
}

/* -----------------------------
   Apply Job (save to localStorage)
----------------------------- */
function applyJob(job) {
  const apps = loadApps();

  const already = apps.find(a => a.job_id === job.id && a.seeker === seekerEmail);
  if (already) return;

  apps.push({
    id: Date.now(),
    job_id: job.id,
    job_title: job.title,
    shop_name: job.shop_name,
    wage: job.wage,
    location: job.location,
    seeker: seekerEmail,
    applied_at: new Date().toISOString()
  });

  localStorage.setItem(APPS_KEY, JSON.stringify(apps));
}

/* -----------------------------
   Render Matching Jobs
----------------------------- */
function renderMatching() {
  const jobs = loadJobs();
  const apps = loadApps();

  const box = document.getElementById("matchList");
  const noMatch = document.getElementById("noMatch");
  box.innerHTML = "";

  if (jobs.length === 0) {
    noMatch.style.display = "block";
    return;
  }
  noMatch.style.display = "none";

  const sorted = jobs
    .map(j => ({ ...j, score: matchScore(j) }))
    .sort((a, b) => b.score - a.score);

  sorted.forEach(job => {
    const applied = apps.find(a => a.job_id === job.id && a.seeker === seekerEmail);

    const card = document.createElement("div");
    card.className = "job-card";

    card.innerHTML = `
      ${job.image ? `<img src="${job.image}" class="job-img">` : ""}

      <h3>${job.title}</h3>
      <p>üè™ ${job.shop_name}</p>
      <p>üìç ${job.location}</p>
      <p>üí∞ ${job.wage} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°.</p>
      <p>‚≠ê ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°: <b>${job.score}</b></p>

      <button class="btn-detail">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>

      <button class="btn-apply" ${applied ? "disabled" : ""}>
        ${applied ? "‚úî ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß" : "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô"}
      </button>
    `;

    /* --- ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î --- */
    card.querySelector(".btn-detail").onclick = () => {
      Swal.fire({
        title: job.title,
        html: `
          <p><b>‡∏£‡πâ‡∏≤‡∏ô:</b> ${job.shop_name}</p>
          <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</b> ${job.location}</p>
          <p><b>‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á:</b> ${job.wage} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°.</p>
          <p><b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b><br>${job.description || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"}</p>
        `,
        confirmButtonText: "‡∏õ‡∏¥‡∏î"
      });
    };

    /* --- ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô --- */
    card.querySelector(".btn-apply").onclick = () => {
      if (applied) return;

      Swal.fire({
        title: "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?",
        text: job.title,
        showCancelButton: true,
        confirmButtonText: "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô",
        cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
      }).then(res => {
        if (res.isConfirmed) {
          applyJob(job);
          Swal.fire("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "", "success");
          renderMatching();
        }
      });
    };

    box.appendChild(card);
  });
}

/* -----------------------------
   Logout
----------------------------- */
document.getElementById("logoutBtn").onclick = () => {
  Swal.fire({
    title:"‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?",
    showCancelButton:true,
    confirmButtonText:"‡∏≠‡∏≠‡∏Å",
    cancelButtonText:"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }).then(res => {
    if (res.isConfirmed) {
      localStorage.removeItem("pt_seeker_session");
      location.href="../index.html";
    }
  });
};

renderMatching();

</script>

</body>
</html>
