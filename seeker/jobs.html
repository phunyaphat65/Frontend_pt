<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>üîé ‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin:0; padding:0;
      background:#eef1f9;
      font-family:"Prompt", sans-serif;
      display:flex;
      height:100vh;
      overflow:hidden;
    }

    /* ---------------- Sidebar ---------------- */
    .sidebar {
      width:240px; background:#ffffff;
      border-right:1px solid #dfe3ef;
      padding:20px 0;
      display:flex; flex-direction:column;
    }

    .logo {
      font-size:20px;
      font-weight:600;
      text-align:center;
      color:#444;
      margin-bottom:24px;
    }

    .menu {
      display:flex; flex-direction:column;
      gap:6px;
      padding:0 16px;
    }

    .menu a {
      padding:10px 14px;
      text-decoration:none;
      color:#555;
      font-size:15px;
      border-radius:8px;
      transition:0.2s;
    }

    .menu a.active {
      background:#eef2ff;
      color:#4c55d9;
      font-weight:600;
    }

    .menu a:hover { background:#f4f5ff; }

    .logout-area {
      margin-top:auto;
      padding:20px;
    }
    .btn-logout {
      width:100%; border:none; padding:10px;
      background:#d9534f; color:#fff;
      border-radius:8px;
      cursor:pointer; font-size:14px;
    }
    .btn-logout:hover { opacity:.88; }

    /* ---------------- Main Content ---------------- */
    .main {
      flex:1; overflow-y:auto;
      padding:30px 40px;
    }

    .page-title {
      font-size:26px;
      color:#222;
      margin:0;
      font-weight:600;
    }

    .subtitle {
      color:#666;
      margin-top:4px;
      font-size:14px;
    }

    /* ---------------- Job Cards ---------------- */
    .job-list {
      margin-top:28px;
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
      gap:18px;
    }

    .job-card {
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
      padding:18px;
      transition:0.2s;
      position:relative;
      cursor:pointer;
    }
    .job-card:hover { transform:translateY(-4px); }

    .job-card img {
      width:100%;
      height:150px;
      border-radius:12px;
      object-fit:cover;
      margin-top:10px;
    }

    .like-btn {
      background:none;
      border:none;
      font-size:22px;
      cursor:pointer;
      position:absolute;
      top:12px;
      right:12px;
    }

    /* ---------------- Modal ---------------- */
    .modal {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.45);
      display:flex;
      justify-content:center;
      align-items:flex-end;
      visibility:hidden;
      opacity:0;
      transition:0.25s;
    }
    .modal.active {
      visibility:visible;
      opacity:1;
    }

    .modal-box {
      width:100%;
      max-width:520px;
      background:#fff;
      border-radius:18px 18px 0 0;
      padding:24px;
      transform:translateY(120px);
      transition:0.25s;
      position:relative;
    }
    .modal.active .modal-box {
      transform:translateY(0);
    }

    .modal-close {
      position:absolute;
      top:12px; right:20px;
      font-size:22px; cursor:pointer;
      color:#777;
    }

    #map {
      height:230px;
      border-radius:12px;
      margin-top:12px;
    }

    .apply-btn {
      background:linear-gradient(90deg,#667eea,#764ba2);
      color:#fff;
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      font-size:17px;
      cursor:pointer;
      margin-top:16px;
    }
  </style>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

<!-- ---------------------- LOGIN CHECK ---------------------- -->
<script>
(function () {
  const session = localStorage.getItem("pt_seeker_session");

  if (!session) {
    Swal.fire({
      icon: "warning",
      title: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô",
      confirmButtonText: "‡∏ï‡∏Å‡∏•‡∏á"
    }).then(() => {
      window.location.href = "../auth.html";
    });
    return;
  }

  try {
    window.currentUser = JSON.parse(session);
  } catch {
    localStorage.removeItem("pt_seeker_session");
    window.location.href = "../auth.html";
  }
})();
</script>

<!-- ---------------------- Sidebar ---------------------- -->
<div class="sidebar">
  <div class="logo">Part-time Match</div>

  <div class="menu">
    <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
    <a href="jobs.html" class="active">‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
    <a href="applications.html">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
    <a href="matching.html">AI Matching</a>
    <a href="reviews.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
  </div>

  <div class="logout-area">
    <button id="logoutBtn" class="btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </div>
</div>

<!-- ---------------------- Main ---------------------- -->
<div class="main">
  <h2 class="page-title">üîé ‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå</h2>
  <p class="subtitle">‡∏á‡∏≤‡∏ô‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏ó‡∏°‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</p>

  <div id="jobList" class="job-list"></div>

  <p id="emptyState"
     style="text-align:center;color:#888;margin-top:20px;display:none;">
    ‚ùó ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
  </p>
</div>

<!-- ---------------------- Modal ---------------------- -->
<div id="jobModal" class="modal">
  <div class="modal-box">
    <span id="closeModal" class="modal-close">&times;</span>

    <h3 id="jobTitle"></h3>
    <p><strong>‡∏£‡πâ‡∏≤‡∏ô:</strong> <span id="shopName"></span></p>
    <p><strong>‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á:</strong> <span id="jobWage"></span> ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°.</p>
    <p><strong>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô:</strong> <span id="jobStartDate"></span></p>
    <p id="jobLocation"></p>
    <p id="jobDesc"></p>

    <img id="jobImage" style="width:100%;border-radius:12px;margin:10px 0;display:none;">

    <div id="map"></div>

    <button id="applyBtn" class="apply-btn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</button>
  </div>
</div>

<script>
/* STORAGE KEYS */
const JOB_STORAGE = "pt_jobs";
const LIKE_KEY = "pt_like_jobs";
const APPLIED_KEY = "pt_applications";

let jobs = JSON.parse(localStorage.getItem(JOB_STORAGE) || "[]");
let liked = JSON.parse(localStorage.getItem(LIKE_KEY) || "[]");
let applications = JSON.parse(localStorage.getItem(APPLIED_KEY) || "[]");

/* ---------------- Render Job Cards ---------------- */
function renderJobs() {
  const jobList = document.getElementById("jobList");
  const empty = document.getElementById("emptyState");

  jobList.innerHTML = "";
  empty.style.display = jobs.length === 0 ? "block" : "none";

  jobs.forEach(job => {
    const card = document.createElement("div");
    card.className = "job-card";

    const heart = liked.includes(job.id) ? "‚ù§Ô∏è" : "ü§ç";

    card.innerHTML = `
      <h3>${job.title}</h3>
      <p>üè™ ${job.shop_name}</p>
      <p>üìç ${job.location}</p>
      <p>üí∞ ${job.wage} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°.</p>

      <button class="like-btn" data-id="${job.id}">${heart}</button>

      ${job.image ? `<img src="${job.image}">` : ""}
    `;

    card.onclick = e => {
      if (e.target.classList.contains("like-btn")) return;
      openModal(job);
    };

    card.querySelector(".like-btn").onclick = e => {
      e.stopPropagation();
      toggleLike(job.id);
    };

    jobList.appendChild(card);
  });
}

function toggleLike(id) {
  if (liked.includes(id)) {
    liked = liked.filter(j => j !== id);
  } else liked.push(id);

  localStorage.setItem(LIKE_KEY, JSON.stringify(liked));
  renderJobs();
}

/* ---------------- Modal ---------------- */
let modal = document.getElementById("jobModal");
document.getElementById("closeModal").onclick =
  () => modal.classList.remove("active");

let map;

function openModal(job) {
  modal.classList.add("active");

  document.getElementById("jobTitle").innerText = job.title;
  document.getElementById("shopName").innerText = job.shop_name;
  document.getElementById("jobWage").innerText = job.wage;
  document.getElementById("jobStartDate").innerText = job.startDate || "-";
  document.getElementById("jobLocation").innerText = "üìç " + (job.location || "-");
  document.getElementById("jobDesc").innerText = job.description || "-";

  const jobImage = document.getElementById("jobImage");
  if (job.image) {
    jobImage.src = job.image;
    jobImage.style.display = "block";
  } else jobImage.style.display = "none";

  setTimeout(() => {
    map = L.map("map").setView([job.lat || 13.75, job.lng || 100.5], 14);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
      .addTo(map);

    if (job.lat && job.lng) {
      L.marker([job.lat, job.lng]).addTo(map);
    }
  }, 200);

  document.getElementById("applyBtn").onclick = () => applyJob(job);
}

/* ---------------- SAVE APPLICATION ---------------- */
function applyJob(job) {

  const exist = applications.find(a => a.id === job.id);
  if (exist) {
    Swal.fire("‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß!", "", "info");
    return;
  }

  const newApply = {
    id: job.id,
    job_title: job.title,
    shop_name: job.shop_name,
    wage: job.wage,
    location: job.location,
    status: "pending",
    applied_at: Date.now()
  };

  applications.push(newApply);
  localStorage.setItem(APPLIED_KEY, JSON.stringify(applications));

  Swal.fire("‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß!", "", "success");
}

/* ---------------- Logout ---------------- */
document.getElementById("logoutBtn").onclick = () => {
  Swal.fire({
    title: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?",
    icon: "question",
    showCancelButton: true,
    confirmButtonText: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
    cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }).then(res => {
    if (res.isConfirmed) {
      localStorage.removeItem("pt_seeker_session");
      location.href = "../auth.html";
    }
  });
};

renderJobs();
</script>

</body>
</html>
