<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>üìÑ ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      margin:0;
      padding:0;
      background:#eef1f9;
      font-family:"Prompt", sans-serif;
      display:flex;
      height:100vh;
      overflow:hidden;
    }

    /* ---------------- Sidebar ---------------- */
    .sidebar {
      width:240px;
      background:#ffffff;
      border-right:1px solid #dfe3ef;
      padding:20px 0;
      display:flex;
      flex-direction:column;
    }

    .logo {
      font-size:20px;
      font-weight:600;
      text-align:center;
      color:#444;
      margin-bottom:24px;
    }

    .menu {
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:0 16px;
    }

    .menu a {
      padding:10px 14px;
      text-decoration:none;
      color:#555;
      font-size:15px;
      border-radius:8px;
      transition:0.2s;
    }

    .menu a.active {
      background:#eef2ff;
      color:#4c55d9;
      font-weight:600;
    }

    .menu a:hover {
      background:#f4f5ff;
    }

    .logout-area {
      margin-top:auto;
      padding:20px;
    }

    .btn-logout {
      width:100%;
      border:none;
      padding:10px;
      background:#d9534f;
      color:#fff;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
    }

    /* ---------------- Main ---------------- */
    .main {
      flex:1;
      overflow-y:auto;
      padding:30px 40px;
    }

    .page-title {
      font-size:26px;
      color:#222;
      margin:0;
      font-weight:600;
    }

    .subtitle {
      color:#666;
      margin-top:4px;
      font-size:14px;
    }

    /* ---------------- Cards ---------------- */
    .app-list {
      margin-top:28px;
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
      gap:18px;
    }

    .app-card {
      background:#fff;
      padding:18px;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
      transition:0.2s;
    }

    .badge {
      display:inline-block;
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
      font-weight:600;
      color:#fff;
    }

    .btn-cancel {
      margin-top:12px;
      padding:10px;
      width:100%;
      background:#d9534f;
      border:none;
      border-radius:10px;
      color:#fff;
      cursor:pointer;
      font-size:15px;
    }

    .no-data {
      text-align:center;
      color:#888;
      margin-top:20px;
    }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">Part-time Match</div>

    <div class="menu">
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="jobs.html">‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html" class="active">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="matching.html">AI Matching</a>
      <a href="reviews.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>

    <div class="logout-area">
      <button id="logoutBtn" class="btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <h2 class="page-title">üìÑ ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
    <p class="subtitle">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>

    <div id="applicationsList" class="app-list"></div>
  </div>


<script>
// ----------------------------------------------------------
// CONFIG
// ----------------------------------------------------------
const SESSION = "pt_seeker_session";
const APPS_KEY = "pt_applications";
const JOBS_KEY = "jobs";

// ----------------------------------------------------------
// LOGIN CHECK
// ----------------------------------------------------------
const seekerEmail = localStorage.getItem(SESSION);
if (!seekerEmail) {
  Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô", "", "warning")
    .then(() => location.href = "../auth.html");
}

// ----------------------------------------------------------
// LOAD DATA
// ----------------------------------------------------------
const loadApplications = () => {
  const all = JSON.parse(localStorage.getItem(APPS_KEY) || "[]");
  return all.filter(a => a.applicant === seekerEmail);
};

const loadJobs = () =>
  JSON.parse(localStorage.getItem(JOBS_KEY) || "[]");

// ----------------------------------------------------------
// STATUS COLOR & TEXT
// ----------------------------------------------------------
function getStatusData(status) {
  return ({
    pending:    { text:"‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", color:"#f2c94c" },
    reviewing:  { text:"üîé ‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", color:"#3498db" },
    interview:  { text:"üìû ‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå", color:"#9b59b6" },
    approved:   { text:"‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å", color:"#27ae60" },
    hired:      { text:"üéâ ‡πÑ‡∏î‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß", color:"#1f8a4c" },
    rejected:   { text:"‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô", color:"#eb5757" },
    cancelled:  { text:"‚ö™ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß", color:"#95a5a6" },
  }[status] || { text:status, color:"#999" });
}

// ----------------------------------------------------------
// RENDER APPLICATIONS
// ----------------------------------------------------------
function renderApplications() {
  const apps = loadApplications();
  const jobs = loadJobs();
  const list = document.getElementById("applicationsList");

  list.innerHTML = "";

  if (apps.length === 0) {
    list.innerHTML = `<p class="no-data">‚ùó ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡πÉ‡∏î‡πÄ‡∏•‡∏¢</p>`;
    return;
  }

  apps.sort((a,b) => new Date(b.applied_at) - new Date(a.applied_at));

  apps.forEach(app => {
    const job = jobs.find(j => j.id === app.job_id);

    const card = document.createElement("div");
    card.className = "app-card";

    const status = getStatusData(app.status);

    const date = new Date(app.applied_at).toLocaleString("th-TH");

    card.innerHTML = `
      <h3>${app.job_title || "(‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß)"}</h3>
      <p>üè™ ${app.shop_name || "-"}</p>
      <p>üìç ${app.location || "-"}</p>
      <p>üí∞ ${app.wage || "-"} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°.</p>

      <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ${date}</p>

      <span class="badge" style="background:${status.color}">
        ${status.text}
      </span>
    `;

    // ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ pending
    if (app.status === "pending") {
      const btn = document.createElement("button");
      btn.className = "btn-cancel";
      btn.innerHTML = `<i class="fa-solid fa-ban"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£`;
      btn.onclick = () => cancelApplication(app.id);
      card.appendChild(btn);
    }

    list.appendChild(card);
  });
}

// ----------------------------------------------------------
// CANCEL APPLICATION  (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô cancelled)
// ----------------------------------------------------------
function cancelApplication(id) {
  Swal.fire({
    title:"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£?",
    text:"‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà",
    icon:"warning",
    showCancelButton:true,
    confirmButtonText:"‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
    cancelButtonText:"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }).then(res => {
    if (!res.isConfirmed) return;

    let all = JSON.parse(localStorage.getItem(APPS_KEY) || "[]");

    all = all.map(a => {
      if (a.id === id) a.status = "cancelled";
      return a;
    });

    localStorage.setItem(APPS_KEY, JSON.stringify(all));

    Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß", "success");

    renderApplications();
  });
}

// ----------------------------------------------------------
// LOGOUT
// ----------------------------------------------------------
document.getElementById("logoutBtn").onclick = () => {
  Swal.fire({
    title:"‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?",
    icon:"question",
    showCancelButton:true,
    confirmButtonText:"‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
    cancelButtonText:"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }).then(res=>{
    if(res.isConfirmed){
      localStorage.removeItem(SESSION);
      location.href="../index.html";
    }
  });
};

// START
renderApplications();
</script>

</body>
</html>
