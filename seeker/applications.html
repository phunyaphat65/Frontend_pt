<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
    body {
      font-family: "Prompt", sans-serif;
      background: #f6f8fc;
      margin: 0;
      min-height: 100vh;
    }
    nav {
      background: linear-gradient(90deg, #667eea, #764ba2);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    nav .left a {
      color: #fff;
      text-decoration: none;
      margin-right: 20px;
      font-weight: 500;
      transition: opacity .2s;
    }
    nav .left a:hover { opacity: .8; }
    nav button {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 14px;
    }
    nav button:hover { background: rgba(255,255,255,0.35); }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
      padding: 30px 40px;
      animation: fadeIn 0.4s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .application-card {
      background: #f9faff;
      border: 1px solid #e2e6f3;
      border-radius: 15px;
      padding: 20px 25px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: transform .2s, box-shadow .2s;
    }
    .application-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    }
    .job-info { flex: 1; }
    .job-info h3 {
      margin: 0 0 5px;
      color: #333;
      font-size: 18px;
      font-weight: 600;
    }
    .job-info p {
      margin: 2px 0;
      color: #555;
      font-size: 14px;
    }
    .status {
      font-weight: 500;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      display: inline-block;
      text-align: center;
      min-width: 110px;
    }
    .status.pending { background: #fff7e6; color: #b58500; }
    .status.approved { background: #e8f9f0; color: #2f8f4e; }
    .status.rejected { background: #ffeaea; color: #d03c3c; }
    button.cancel-btn {
      background: #f0f1ff;
      border: none;
      color: #444;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 14px;
      transition: all .2s;
      margin-left: 10px;
    }
    button.cancel-btn:hover {
      background: #e0e2ff;
      color: #222;
    }
    .no-data {
      text-align: center;
      color: #888;
      font-size: 15px;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <nav>
    <div class="left">
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="jobs.html">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html" style="font-weight:600;text-decoration:underline;">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="matching.html">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</a>
      <a href="reviews.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>
    <button id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </nav>

  <div class="container">
    <h2>üìÑ ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
    <div id="applicationsList"></div>
  </div>

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    (function() {
      // üîë ‡∏Ñ‡∏µ‡∏¢‡πå LocalStorage
      const SESSION_SEEKER = "pt_seeker_session";
      const SESSION_SHOP   = "pt_shop_session";
      const APPS_KEY       = "pt_applications";
      const listContainer  = document.getElementById("applicationsList");

      // üß≠ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
      const email = localStorage.getItem(SESSION_SEEKER) || localStorage.getItem(SESSION_SHOP);
      if (!email) {
        Swal.fire({
          icon: "warning",
          title: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö",
          text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
          confirmButtonText: "‡∏ï‡∏Å‡∏•‡∏á"
        }).then(() => window.location.href = "../auth.html");
        return;
      }

      // üì• ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      function loadApplications() {
        const apps = JSON.parse(localStorage.getItem(APPS_KEY) || "[]");
        return apps.filter(a => a.applicant === email);
      }

      // üì§ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
      function renderApplications() {
        const apps = loadApplications();
        listContainer.innerHTML = "";

        if (apps.length === 0) {
          listContainer.innerHTML = `<p class="no-data fade-in">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</p>`;
          return;
        }

        apps.sort((a,b)=> new Date(b.date) - new Date(a.date));

        apps.forEach(app => {
          const card = document.createElement("div");
          card.className = "application-card fade-in";

          const info = document.createElement("div");
          info.className = "job-info";
          info.innerHTML = `
            <h3>${app.job_title}</h3>
            <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${app.location || "-"}</p>
            <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£: ${new Date(app.date).toLocaleDateString('th-TH')}</p>
          `;

          const right = document.createElement("div");
          const status = document.createElement("span");
          status.className = "status " + app.status;
          status.textContent = 
            app.status === "pending" ? "‚è≥ ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£" :
            app.status === "approved" ? "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤" :
            "‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô";

          right.appendChild(status);

          if (app.status === "pending") {
            const cancelBtn = document.createElement("button");
            cancelBtn.className = "cancel-btn";
            cancelBtn.textContent = "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
            cancelBtn.onclick = () => cancelApplication(app.id);
            right.appendChild(cancelBtn);
          }

          card.appendChild(info);
          card.appendChild(right);
          listContainer.appendChild(card);
        });
      }

      // ‚ùå ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
      function cancelApplication(id) {
        Swal.fire({
          title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å?",
          text: "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "‡πÉ‡∏ä‡πà, ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏¢",
          cancelButtonText: "‡πÑ‡∏°‡πà"
        }).then(result => {
          if (result.isConfirmed) {
            let apps = JSON.parse(localStorage.getItem(APPS_KEY) || "[]");
            apps = apps.filter(a => a.id !== id);
            localStorage.setItem(APPS_KEY, JSON.stringify(apps));
            renderApplications();
            Swal.fire("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß", "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "success");
          }
        });
      }

      // üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
      document.getElementById("logoutBtn").addEventListener("click", () => {
        Swal.fire({
          title: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?",
          text: "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
          icon: "question",
          showCancelButton: true,
          confirmButtonText: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
          cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
        }).then(result => {
          if (result.isConfirmed) {
            localStorage.removeItem(SESSION_SEEKER);
            localStorage.removeItem(SESSION_SHOP);
            Swal.fire("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "", "success").then(() => {
              window.location.href = "../auth.html";
            });
          }
        });
      });

      // üßæ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      renderApplications();
    })();
  </script>
</body>
</html>
