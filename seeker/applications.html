<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>üìÑ ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      margin:0;
      padding:0;
      background:#eef1f9;
      font-family:"Prompt", sans-serif;
      display:flex;
      height:100vh;
      overflow:hidden;
    }

    .sidebar {
      width:240px;
      background:#ffffff;
      border-right:1px solid #dfe3ef;
      padding:20px 0;
      display:flex;
      flex-direction:column;
    }

    .logo {
      font-size:20px;
      font-weight:600;
      text-align:center;
      color:#444;
      margin-bottom:24px;
    }

    .menu {
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:0 16px;
    }

    .menu a {
      padding:10px 14px;
      text-decoration:none;
      color:#555;
      font-size:15px;
      border-radius:8px;
      transition:0.2s;
    }

    .menu a.active {
      background:#eef2ff;
      color:#4c55d9;
      font-weight:600;
    }

    .menu a:hover {
      background:#f4f5ff;
    }

    .logout-area {
      margin-top:auto;
      padding:20px;
    }

    .btn-logout {
      width:100%;
      border:none;
      padding:10px;
      background:#d9534f;
      color:#fff;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
    }

    .main {
      flex:1;
      overflow-y:auto;
      padding:30px 40px;
    }

    .page-title {
      font-size:26px;
      color:#222;
      margin:0;
      font-weight:600;
    }

    .subtitle {
      color:#666;
      margin-top:4px;
      font-size:14px;
    }

    .app-list {
      margin-top:28px;
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
      gap:18px;
    }

    .app-card {
      background:#fff;
      padding:18px;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
      transition:0.2s;
    }

    .status-badge {
      display:inline-block;
      padding:4px 10px;
      border-radius:8px;
      font-size:13px;
      font-weight:600;
      color:#fff;
    }

    .s-pending { background:#f2c94c; }
    .s-approved { background:#27ae60; }
    .s-rejected { background:#eb5757; }

    .cancel-btn {
      margin-top:12px;
      padding:10px;
      width:100%;
      background:#d9534f;
      border:none;
      border-radius:10px;
      color:#fff;
      cursor:pointer;
      font-size:15px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">Part-time Match</div>

    <div class="menu">
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="jobs.html">‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html" class="active">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="matching.html">AI Matching</a>
      <a href="reviews.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>

    <div class="logout-area">
      <button id="logoutBtn" class="btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <h2 class="page-title">üìÑ ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
    <p class="subtitle">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>

    <div id="appList" class="app-list"></div>

    <p id="emptyState" style="text-align:center;color:#888;margin-top:20px;display:none;">
      ‚ùó ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô‡πÉ‡∏î‡πÄ‡∏•‡∏¢
    </p>
  </div>


<script>

//
// üîí 1) ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
//
const session = JSON.parse(localStorage.getItem("pt_seeker_session") || "null");
if (!session) {
  Swal.fire({
    icon: "warning",
    title: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô",
    confirmButtonText: "‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"
  }).then(() => {
    location.href = "../auth.html";
  });
}

//
// 2) ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
//
const APPLIED_KEY = "pt_applications";
let apps = JSON.parse(localStorage.getItem(APPLIED_KEY) || "[]");

function renderApps() {
  const list = document.getElementById("appList");
  const empty = document.getElementById("emptyState");

  list.innerHTML = "";
  empty.style.display = apps.length === 0 ? "block" : "none";

  apps.forEach(app => {
    const card = document.createElement("div");
    card.className = "app-card";

    const statusClass =
      app.status === "approved" ? "s-approved" :
      app.status === "rejected" ? "s-rejected" : "s-pending";

    const statusText =
      app.status === "approved" ? "‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß" :
      app.status === "rejected" ? "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" : "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö";

    const date = new Date(app.applied_at).toLocaleString("th-TH");

    card.innerHTML = `
      <h3>${app.job_title}</h3>
      <p>üè™ ${app.shop_name}</p>
      <p>üìç ${app.location}</p>
      <p>üí∞ ${app.wage} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°.</p>

      <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ${date}</p>

      <span class="status-badge ${statusClass}">
        ${statusText}
      </span>

      <button class="cancel-btn" data-id="${app.id}">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
    `;

    card.querySelector(".cancel-btn").onclick = () =>
      cancelApplication(app.id);

    list.appendChild(card);
  });
}

//
// 3) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
//
function cancelApplication(id) {
  Swal.fire({
    title: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£?",
    text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà",
    icon: "warning",
    showCancelButton: true,
    confirmButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£",
    cancelButtonText: "‡∏õ‡∏¥‡∏î"
  }).then(res => {
    if (!res.isConfirmed) return;

    apps = apps.filter(a => a.id !== id);
    localStorage.setItem(APPLIED_KEY, JSON.stringify(apps));

    renderApps();

    Swal.fire("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß", "‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", "success");
  });
}

//
// 4) ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
//
document.getElementById("logoutBtn").onclick = () => {
  Swal.fire({
    title: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?",
    icon: "question",
    showCancelButton: true,
    confirmButtonText: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
    cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }).then(res => {
    if (res.isConfirmed) {
      localStorage.removeItem("pt_seeker_session");
      location.href = "../auth.html";
    }
  });
};

renderApps();
</script>

</body>
</html>
