<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡∏´‡∏≤‡∏á‡∏≤‡∏ô | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
    body {
      font-family: "Prompt", sans-serif;
      background: #f6f8fc;
      margin: 0;
      min-height: 100vh;
    }
    nav {
      background: linear-gradient(90deg, #667eea, #764ba2);
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px;
    }
    nav .left a {
      color: #fff;
      text-decoration: none;
      margin-right: 20px;
      font-weight: 500;
      transition: opacity .2s;
    }
    nav .left a:hover { opacity: .8; }
    nav button {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 14px;
    }
    nav button:hover { background: rgba(255,255,255,0.35); }

    .container {
      max-width: 850px;
      margin: 40px auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      padding: 30px 40px;
      animation: fadeIn 0.4s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 { color: #333; margin-bottom: 25px; font-weight: 600; text-align: center; }

    .profile-pic { text-align: center; margin-bottom: 25px; }
    .profile-pic img {
      width: 130px; height: 130px;
      border-radius: 50%; object-fit: cover;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .upload-btn {
      display: block; margin: 10px auto;
      color: #667eea; cursor: pointer;
      font-size: 14px; text-decoration: underline;
      border: none; background: none;
    }
    label { font-weight: 500; margin-bottom: 6px; display: block; color: #444; }
    input, textarea {
      width: 100%; padding: 12px;
      border-radius: 10px; border: 1px solid #ccc;
      font-size: 15px; margin-bottom: 15px;
      transition: border .2s, box-shadow .2s;
    }
    input:focus, textarea:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.2);
      outline: none;
    }
    button.save-btn {
      width: 100%; padding: 12px;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border: none; color: white;
      font-size: 16px; border-radius: 10px;
      cursor: pointer; font-weight: 500;
      transition: opacity .25s;
    }
    button.save-btn:hover { opacity: .9; }

    #map {
      width: 100%; height: 300px;
      border-radius: 12px;
      margin-bottom: 15px;
    }
  </style>
</head>

<body>
  <nav>
    <div class="left">
      <a href="profile.html" style="text-decoration:underline;">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="jobs.html">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="matching.html">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</a>
      <a href="reviews.html">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>
    <button id="logoutBtn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </nav>

  <div class="container">
    <h2>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>

    <div class="profile-pic">
      <img id="previewImg" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="Profile">
      <input type="file" id="profileImageInput" accept="image/*" style="display:none">
      <button class="upload-btn" id="uploadBtn">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
    </div>

    <form id="profileForm">
      <label>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
      <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" required>

      <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ)</label>
      <input type="email" id="email" disabled>

      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input type="tel" id="phone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678" pattern="0[0-9]{9}">

      <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏≤‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ)</label>
      <textarea id="address" rows="2" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"></textarea>
      <div id="map"></div>

      <label>‡∏ó‡∏±‡∏Å‡∏©‡∏∞ / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ</label>
      <textarea id="skills" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÅ‡∏Ñ‡∏ä‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå"></textarea>

      <label>‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
      <textarea id="experience" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"></textarea>

      <button type="submit" class="save-btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    (() => {
      const USERS_KEY = "pt_users";
      const SESSION_KEY = "pt_seeker_session";

      let map, marker;
      let currentLat = 13.7563, currentLng = 100.5018;

      // üó∫ ‡πÇ‡∏´‡∏•‡∏î Google Maps
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: currentLat, lng: currentLng },
          zoom: 13,
        });
        marker = new google.maps.Marker({
          position: { lat: currentLat, lng: currentLng },
          map,
          draggable: true,
        });
        marker.addListener('dragend', () => {
          const pos = marker.getPosition();
          currentLat = pos.lat();
          currentLng = pos.lng();
        });
      }

      function getCurrentUser() {
        const email = localStorage.getItem(SESSION_KEY);
        if (!email) return null;
        const users = JSON.parse(localStorage.getItem(USERS_KEY) || "[]");
        return users.find(u => u.email === email && u.role === "seeker");
      }

      function saveUser(updatedUser) {
        const users = JSON.parse(localStorage.getItem(USERS_KEY) || "[]");
        const idx = users.findIndex(u => u.email === updatedUser.email);
        if (idx !== -1) {
          users[idx] = updatedUser;
          localStorage.setItem(USERS_KEY, JSON.stringify(users));
        }
      }

      const user = getCurrentUser();
      if (!user) {
        Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô", "", "warning").then(() => {
          window.location.href = "../auth.html";
        });
        return;
      }

      const previewImg = document.getElementById('previewImg');
      const uploadBtn = document.getElementById('uploadBtn');
      const fileInput = document.getElementById('profileImageInput');

      // üß† ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      document.getElementById('email').value = user.email || "";
      document.getElementById('name').value = user.name || "";
      document.getElementById('phone').value = user.phone || "";
      document.getElementById('address').value = user.address || "";
      document.getElementById('skills').value = user.skills || "";
      document.getElementById('experience').value = user.experience || "";
      if (user.profile_image) previewImg.src = user.profile_image;
      if (user.lat && user.lng) { currentLat = user.lat; currentLng = user.lng; }

      uploadBtn.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => { previewImg.src = reader.result; };
          reader.readAsDataURL(file);
        }
      });

      // üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      document.getElementById('profileForm').addEventListener('submit', e => {
        e.preventDefault();

        const phone = document.getElementById('phone').value.trim();
        if (phone && !/^0\d{9}$/.test(phone)) {
          Swal.fire("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å", "warning");
          return;
        }

        const updated = {
          ...user,
          name: document.getElementById('name').value.trim(),
          phone,
          address: document.getElementById('address').value.trim(),
          skills: document.getElementById('skills').value.trim(),
          experience: document.getElementById('experience').value.trim(),
          profile_image: previewImg.src,
          lat: currentLat,
          lng: currentLng,
        };
        saveUser(updated);

        Swal.fire("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!", "", "success");
      });

      document.getElementById('logoutBtn').addEventListener('click', () => {
        Swal.fire({
          title: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?",
          icon: "question",
          showCancelButton: true,
          confirmButtonText: "‡πÉ‡∏ä‡πà, ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
          cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
        }).then(res => {
          if (res.isConfirmed) {
            localStorage.removeItem(SESSION_KEY);
            window.location.href = "../auth.html";
          }
        });
      });

      window.initMap = initMap;
    })();
  </script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhOq2e2YYl308urG4HnTDRr4pqKdv8jhE&callback=initMap">
  </script>
</body>
</html>
