<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡πâ‡∏≤‡∏ô / ‡∏á‡∏≤‡∏ô | Part-time Match</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      margin:0; padding:0; background:#eef1f9;
      font-family:"Prompt", sans-serif;
      display:flex;
      height:100vh;
      overflow:hidden;
    }

    /* ---------------- Sidebar ---------------- */
    .sidebar {
      width:240px; 
      background:#ffffff;
      border-right:1px solid #dfe3ef;
      padding:20px 0;
      display:flex; 
      flex-direction:column;
    }

    .logo {
      font-size:20px; 
      font-weight:600; 
      text-align:center;
      color:#444; 
      margin-bottom:24px;
    }

    .menu {
      display:flex; 
      flex-direction:column;
      gap:6px; 
      padding:0 16px;
    }

    .menu a {
      padding:10px 14px;
      text-decoration:none;
      color:#555;
      font-size:15px;
      border-radius:8px;
      transition:0.2s;
    }

    .menu a.active {
      background:#eef2ff;
      color:#4c55d9;
      font-weight:600;
    }

    .menu a:hover { background:#f4f5ff; }

    .logout-area {
      margin-top:auto;
      padding:20px;
    }

    .btn-logout {
      width:100%; border:none; padding:10px;
      background:#d9534f; color:#fff; border-radius:8px;
      cursor:pointer; font-size:14px;
    }

    /* ---------------- Main ---------------- */
    .main {
      flex:1;
      overflow-y:auto;
      padding:30px 40px;
    }

    .page-title {
      font-size:26px;
      font-weight:600;
      margin:0;
      color:#222;
    }

    .subtitle {
      margin:4px 0 24px 0;
      color:#666; 
      font-size:14px;
    }

    /* ---------------- Review Page ---------------- */
    .card {
      max-width:850px;
      background:#fff;
      padding:30px 40px;
      border-radius:20px;
      box-shadow:0 8px 20px rgba(0,0,0,0.08);
      margin-bottom:30px;
      animation:fadeIn .3s ease;
    }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(10px); }
      to { opacity:1; transform:translateY(0); }
    }

    label {
      display:block;
      margin-bottom:6px;
      font-weight:500;
      color:#444;
    }

    input, textarea, select {
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #ccc;
      font-size:15px;
      margin-bottom:15px;
    }

    form button {
      padding:10px 16px;
      border:none;
      border-radius:8px;
      background:linear-gradient(90deg,#667eea,#764ba2);
      color:#fff;
      cursor:pointer;
      font-size:15px;
    }

    .review-card {
      background:#fafbff;
      border:1px solid #eee;
      border-radius:12px;
      padding:18px;
      margin-bottom:15px;
      transition:.25s;
    }

    .review-card:hover {
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
    }

    .review-header {
      display:flex;
      justify-content:space-between;
      margin-bottom:6px;
    }

    .review-shop { font-weight:600; color:#333; }
    .review-rating { color:#f6b93b; }
    .review-comment { color:#555; margin:6px 0; }
    .review-date { font-size:13px; color:#777; }

    .empty {
      color:#777;
      text-align:center;
      margin-top:20px;
    }
  </style>
</head>

<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">Part-time Match</div>

    <div class="menu">
      <a href="profile.html">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
      <a href="jobs.html">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô</a>
      <a href="applications.html">‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</a>
      <a href="matching.html">AI Matching</a>
      <a href="reviews.html" class="active">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</a>
    </div>

    <div class="logout-area">
      <button id="logoutBtn" class="btn-logout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main">

    <h2 class="page-title">üìù ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏£‡πâ‡∏≤‡∏ô / ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥</h2>
    <p class="subtitle">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ñ‡∏¢‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>

    <!-- ‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß -->
    <div class="card">
      <form id="reviewForm">
        <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô / ‡∏á‡∏≤‡∏ô</label>
        <select id="shopSelect" required></select>

        <label>‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
        <select id="rating" required>
          <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô --</option>
          <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ‡∏î‡∏µ‡∏°‡∏≤‡∏Å</option>
          <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê ‡∏î‡∏µ</option>
          <option value="3">‚≠ê‚≠ê‚≠ê ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
          <option value="2">‚≠ê‚≠ê ‡πÅ‡∏¢‡πà</option>
          <option value="1">‚≠ê ‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å</option>
        </select>

        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
        <textarea id="comment" rows="3" placeholder="‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô..."></textarea>

        <button type="submit">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
      </form>
    </div>

    <!-- ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <h2 class="page-title" style="font-size:22px;">üí¨ ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>

    <div class="card">
      <div id="reviewList"></div>
      <div id="emptyState" class="empty" style="display:none;">
        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      </div>
    </div>

  </div>

<script>
(() => {
  const USERS_KEY = "pt_users";
  const JOBS_KEY = "pt_jobs";
  const APPS_KEY = "pt_applications";
  const REVIEWS_KEY = "pt_reviews";
  const SESSION_KEY = "pt_seeker_session";

  const email = localStorage.getItem(SESSION_KEY);
  if (!email) {
    Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô", "", "warning").then(() => {
      location.href = "../auth.html";
    });
    return;
  }

  const users = JSON.parse(localStorage.getItem(USERS_KEY) || "[]");
  const user = users.find(u => u.email === email && u.role === "seeker");

  if (!user) {
    Swal.fire("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ", "", "error").then(() => {
      localStorage.removeItem(SESSION_KEY);
      location.href = "../auth.html";
    });
    return;
  }

  const jobs = JSON.parse(localStorage.getItem(JOBS_KEY) || "[]");
  const apps = JSON.parse(localStorage.getItem(APPS_KEY) || "[]");
  const reviews = JSON.parse(localStorage.getItem(REVIEWS_KEY) || "[]");

  const shopSelect = document.getElementById("shopSelect");
  const reviewList = document.getElementById("reviewList");
  const emptyState = document.getElementById("emptyState");

  // ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏°‡∏±‡∏Ñ‡∏£
  const myApps = apps.filter(a => a.applicant === email);

  if (myApps.length === 0) {
    shopSelect.innerHTML = `<option value="">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</option>`;
    shopSelect.disabled = true;
  } else {
    shopSelect.innerHTML = myApps
      .map(app => {
        const job = jobs.find(j => j.id === app.job_id);
        if (!job) return "";
        return `<option value="${job.id}">${job.title} (${job.shop_name})</option>`;
      })
      .join("");
  }

  // ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
  const myReviews = reviews.filter(r => r.user_email === email);

  if (myReviews.length === 0) {
    emptyState.style.display = "block";
  } else {
    reviewList.innerHTML = myReviews
      .sort((a,b) => new Date(b.date) - new Date(a.date))
      .map(r => `
        <div class="review-card">
          <div class="review-header">
            <div class="review-shop">${r.shop_name}</div>
            <div class="review-rating">${"‚≠ê".repeat(r.rating)}</div>
          </div>
          <div class="review-comment">${r.comment || "-"}</div>
          <div class="review-date">${new Date(r.date).toLocaleDateString("th-TH")}</div>
        </div>
      `)
      .join("");
  }

  // ‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
  document.getElementById("reviewForm").addEventListener("submit", e => {
    e.preventDefault();

    const jobId = shopSelect.value;
    const rating = parseInt(document.getElementById("rating").value);
    const comment = document.getElementById("comment").value.trim();

    if (!jobId || !rating) {
      Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "", "warning");
      return;
    }

    if (reviews.find(r => r.user_email === email && r.job_id == jobId)) {
      Swal.fire("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß", "", "info");
      return;
    }

    const job = jobs.find(j => j.id == jobId);

    const newReview = {
      id: Date.now(),
      user_email: email,
      job_id: jobId,
      shop_name: job?.shop_name,
      rating,
      comment,
      date: new Date().toISOString()
    };

    reviews.push(newReview);
    localStorage.setItem(REVIEWS_KEY, JSON.stringify(reviews));

    Swal.fire("‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "", "success").then(() => {
      location.reload();
    });
  });

  // logout
  document.getElementById("logoutBtn").onclick = () => {
    localStorage.removeItem(SESSION_KEY);
    Swal.fire("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "", "success").then(() => {
      location.href = "../index.html";
    });
  };

})();
</script>

</body>
</html>
